{% extends "base.html" %}

{% block title %}{{ thread.title }}{% endblock %}

{% block head_style %}
    <style>
        /* (専用CSS - 既存のスタイル) */
        .post-list {
            margin-top: 30px;
            padding-left: 0;
            list-style: none;
        }
        .post-item {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .post-meta {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 10px;
        }
        .post-content {
            white-space: pre-line; 
            color: #222;
            padding-left: 15px; 
            padding-right: 15px; 
            margin-bottom: 20px;
        }
        .reply-form {
            margin-top: 30px;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
        }
        .reply-form h3 {
            margin-top: 0;
            border-bottom: 2px solid #ccc;
            padding-bottom: 5px;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 8px;
            box-sizing: border-box; 
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: sans-serif;
        }
        
        /* ▼▼▼ 今回の追加 ▼▼▼ */
        h1 {
            font-size: 1.8em; /* H2に近いサイズに縮小 */
            padding-bottom: 5px; /* 罫線の下の余白を微調整 */
        }
    </style>
{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ thread.title }}</h1>
    
    <a href="/" class="back-link">← スレッド一覧に戻る</a>

    <ul class="post-list">
        {% for post in thread.posts %}
        <li class="post-item">
            <div class="post-meta">
                <span class="post-author">{{ post.author.username }}</span>
                
                <span style="margin-left: 10px;">{{ post.timestamp.strftime('%Y-%m-%d') }}</span>
                <span style="margin-left: 5px;">{{ post.timestamp.strftime('%H:%M') }}</span> 
            </div>

            <div class="post-content" id="post-content-{{ post.id }}">
                {{ post.content | urlize | safe }}
            </div>


            <div class="post-footer">
                <a href="#reply-form-anchor" 
                   class="footer-link"
                   onclick="quotePost({{ post.id }}, '{{ post.author.username }}')">Reply</a>
                
                <a href="#" class="footer-link">記事先頭</a>
                
                <a href="/" class="footer-link">スレッド一覧</a>
                
                {% if current_user.is_admin %}
                    <form method="POST" 
                          action="{{ url_for('delete_post', post_id=post.id) }}" 
                          class="footer-delete-form"
                          onsubmit="return confirm('本当にこの投稿を削除しますか？');">
                        
                        <button type="submit" class="delete-btn">削除</button>
                    </form>
                {% endif %}
            </div>
        </li>
        {% endfor %}
    </ul>
    
    {% if current_user.is_authenticated %}
    <form class="reply-form" 
          method="POST"
          action="{{ url_for('thread_detail', thread_id=thread.id) }}"
          id="reply-form-anchor">
          
        <h3>このスレッドに返信する</h3>
        <label for="content">メッセージ:</label>
        <textarea id="reply-textarea" name="content"></textarea>
        
        <button type="submit" class="submit-btn">投稿する</button>
    </form>
    {% else %}
    <p class="post-meta">投稿するには、<a href="/login">ログイン</a>してください。</p>
    {% endif %}

</div>

<script>
    function quotePost(postId, authorUsername) {
        var contentElement = document.getElementById('post-content-' + postId);
        var content = contentElement.innerText.trim();
        var quoteText = '> ' + authorUsername + ' 曰く:\n> ' + content.replace(/\n/g, '\n> ') + '\n\n';
        var replyTextarea = document.getElementById('reply-textarea');
        replyTextarea.value = quoteText;
        replyTextarea.focus();
    }
</script>
{% endblock %}